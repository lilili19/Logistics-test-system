layui.define("layer",function(h){var b=layui.jquery,d=layui.layer,c=(layui.device(),"layui-upload-enter"),k="layui-upload-iframe",g={icon:2,shift:6},j={file:"文件",video:"视频",audio:"音频"},f=function(a){this.options=a};f.prototype.init=function(){var n=this,i=n.options,m=b("body"),l=b(i.elem||".layui-upload-file"),a=b('<iframe id="'+k+'" class="'+k+'" name="'+k+'"></iframe>');return b("#"+k)[0]||m.append(a),l.each(function(q,p){p=b(p);var o='<form target="'+k+'" method="'+(i.method||"post")+'" key="set-mine" enctype="multipart/form-data" action="'+(i.url||"")+'"></form>',e=p.attr("lay-type")||i.type;i.unwrap||(o='<div class="layui-box layui-upload-button">'+o+'<span class="layui-upload-icon"><i class="layui-icon">&#xe608;</i>'+(p.attr("lay-title")||i.title||"上传"+(j[e]||"图片"))+"</span></div>"),o=b(o),i.unwrap||o.on("dragover",function(r){r.preventDefault(),b(this).addClass(c)}).on("dragleave",function(){b(this).removeClass(c)}).on("drop",function(){b(this).removeClass(c)}),p.parent("form").attr("target")===k&&(i.unwrap?p.unwrap():(p.parent().next().remove(),p.unwrap().unwrap())),p.wrap(o),p.off("change").on("change",function(){n.action(this,e)})})},f.prototype.action=function(t,q){var m=this,x=m.options,w=t.value,n=b(t),a=n.attr("lay-ext")||x.ext||"";if(w){switch(q){case"file":if(a&&!RegExp("\\w\\.("+a+")$","i").test(escape(w))){return d.msg("不支持该文件格式",g),t.value=""}break;case"video":if(!RegExp("\\w\\.("+(a||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(w))){return d.msg("不支持该视频格式",g),t.value=""}break;case"audio":if(!RegExp("\\w\\.("+(a||"mp3|wav|mid")+")$","i").test(escape(w))){return d.msg("不支持该音频格式",g),t.value=""}break;default:if(!RegExp("\\w\\.("+(a||"jpg|png|gif|bmp|jpeg")+")$","i").test(escape(w))){return d.msg("不支持该图片格式",g),t.value=""}}x.before&&x.before(t),n.parent().submit();var v=b("#"+k),r=setInterval(function(){var e;try{e=v.contents().find("body").text()}catch(l){d.msg("上传接口存在跨域",g),clearInterval(r)}if(e){clearInterval(r),v.contents().find("body").html("");try{e=JSON.parse(e)}catch(l){return e={},d.msg("请对上传接口返回JSON字符",g)}"function"==typeof x.success&&x.success(e,t)}},30);t.value=""}},h("upload",function(l){var i=new f(l=l||{});i.init()})});